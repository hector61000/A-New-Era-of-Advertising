async function generateAd(productData) {
    try {
        const platformPrompts = {
            facebook: "Ù†Øµ Ø´Ø§Ù…Ù„ ÙˆØ¹Ø§Ø·ÙÙŠ ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Øµ Ø·ÙˆÙŠÙ„Ø§Ù‹ ÙˆÙ…ÙØµÙ„Ø§Ù‹ Ù…Ø¹ 300 ÙƒÙ„Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.",
            instagram: "Ù†Øµ Ù‚ØµÙŠØ± ÙˆØ¬Ø°Ø§Ø¨ Ù…Ø¹ Ø±Ù…ÙˆØ² ØªØ¹Ø¨ÙŠØ±ÙŠØ© ğŸŒŸ ÙŠÙ†Ø§Ø³Ø¨ Ù…Ù†ØµØ© Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Øµ 300 ÙƒÙ„Ù…Ø©.",
            google: "Ù†Øµ Ù…ÙˆØ¬Ø² ÙˆÙˆØ§Ø¶Ø­ Ù…Ø¹ ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù†Øµ 300 ÙƒÙ„Ù…Ø©."
        };

        const systemPrompt = `Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©. Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ù„Ø§Ù† Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ù†Ø§Ø³Ø¨ Ù„Ù…Ù†ØµØ© ${productData.platform}. ${platformPrompts[productData.platform]}

Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:
- Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬: ${productData.productName}
- Ø§Ù„ÙˆØµÙ: ${productData.description}
${productData.price ? `- Ø§Ù„Ø³Ø¹Ø±: ${productData.price}` : ''}

ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:
1. Ø¬Ø°Ø§Ø¨Ø§Ù‹ ÙˆÙ…Ù‚Ù†Ø¹Ø§Ù‹ ÙˆÙ…Ù†Ø³Ù‚Ø§Ù‹ Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ
2. ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø²Ø§ÙŠØ§ ÙˆÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø´ÙƒÙ„ Ù…ÙØµÙ„
3. ÙŠØªØ¶Ù…Ù† Ø¯Ø¹ÙˆØ© Ù„Ù„ØªÙˆØ§ØµÙ„
4. ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 5-7 Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø©
5. ÙŠØªØ¶Ù…Ù† 3-5 Ù†ØµØ§Ø¦Ø­ ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ù…ÙÙŠØ¯Ø©`;

        const userPrompt = "Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ù„Ø§Ù† Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¹ Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª ÙˆÙ†ØµØ§Ø¦Ø­ ØªØ³ÙˆÙŠÙ‚ÙŠØ©";

        const response = await invokeAIAgent(systemPrompt, userPrompt);
        
        // Extract hashtags from the response
        const hashtags = response.match(/#[\u0600-\u06FFa-zA-Z0-9_]+/g) || [];
        const content = response.replace(/#[\u0600-\u06FFa-zA-Z0-9_]+/g, '').trim();

        // Generate marketing tips
        const marketingTips = [
            "Ø§Ø³ØªØ®Ø¯Ù… ØµÙˆØ±Ø§Ù‹ Ø¬Ø°Ø§Ø¨Ø© ÙˆØ¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø© Ù„Ù…Ù†ØªØ¬Ùƒ",
            "Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ Ù„Ø¶Ù…Ø§Ù† ÙØ¹Ø§Ù„ÙŠØªÙ‡",
            "Ø§Ø³ØªÙ‡Ø¯Ù Ø¬Ù…Ù‡ÙˆØ±Ùƒ ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ù†Ø´Ø§Ø·Ù‡Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©",
            "Ø§Ø¬Ø¹Ù„ Ø¹Ù†ÙˆØ§Ù† Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù…Ù…ÙŠØ²Ø§Ù‹ ÙˆÙ…Ù„ÙØªØ§Ù‹ Ù„Ù„Ø§Ù†ØªØ¨Ø§Ù‡",
            "Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ø±ÙˆØ¶Ø§Ù‹ Ø­ØµØ±ÙŠØ© Ù„ØªØ­ÙÙŠØ² Ø§Ù„ØªÙØ§Ø¹Ù„"
        ];

        return {
            content,
            hashtags: hashtags.map(tag => tag.replace('#', '')),
            whatsapp: productData.whatsapp,
            platform: productData.platform,
            marketingTips
        };
    } catch (error) {
        reportError(error);
        throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
    }
}
